---
name: baseimage_rhel_7_9_python
description: rhel 7.9 base image component for installing python
schemaVersion: 1.0
parameters:
  - Version:
      type: string
      default: "0.0.1"
      description: Component version (update this each time the file changes)
  - Platform:
      type: string
      default: "Linux"
      description: Platform.
  - PythonVersion:
      type: string
      default: "3.9.6"
      description: Python version.
phases:
  - name: build
    steps:
      - name: InstallPython3-9
        action: ExecuteBash
        inputs:
          commands:    
            - Fn::Base64: !Sub |
              set -e
              cd /tmp

              py_filename=Python-${PythonVersion}

              # install python
              wget https://www.python.org/ftp/python/${PythonVersion}/${!py_filename}.tgz
              tar xzf ${!py_filename}.tgz
              rm -f ${!py_filename}.tgz
              cd ${!py_filename}

              #Â ensure zlib is enabled, required for some ansible modules
              sed -i 's/^#zlib/zlib/' Modules/Setup

              ./configure --enable-optimizations
              sudo make altinstall

      # Install pip for Python 3.9
      - name: InstallPipAndVirtualenv
        action: ExecuteBash
        inputs:
          commands:
            - |
              set -e

              # install pip and virtualenv
              python3.9 -m pip install --upgrade pip
              python3.9 -m pip install virtualenv
