---
name: delius_iaps_install_base_packages
description: Install base package managers and packages
schemaVersion: 1.0
parameters:
  - Version:
      type: string
      default: 0.1.7
      description: Component version
  - Platform:
      type: string
      default: "Windows"
      description: Platform name
phases:
  - name: build
    steps:
      - name: DeliusIapsInstallBasePackages
        action: ExecutePowerShell
        inputs:
          commands:
            - |
              $ErrorActionPreference = "Stop"
              $VerbosePreference = "Continue"

              Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

              Write-Host('vcredist packages')
              # choco install -y vcredist2010 # Commented out - hoping we don't need to explicitly mention this due to dynamic package dependency
              # choco install -y vcredist2008 # Commented out - hoping we don't need to explicitly mention this due to dynamic package dependency
              choco install -y vcredist140
              choco install -y vcredist2015

              # install PSCX module
              Install-Module -Name Pscx -AllowClobber

              Write-Host('nginx proxy')
              choco install -y nginx

              Write-Host('Firefox browser')
              choco install -y firefox # install latest version

              Write-Host('7Zip archive util')
              choco install -y 7zip # install latest version

              Write-Host('OpenSSL util')
              choco install -y openssl # install latest version

              # Move OpenSSL to a location that is in the PATH
              Move-Item -Path "C:\Program Files\OpenSSL-Win64\bin\openssl.exe" -Destination "C:\ProgramData\chocolatey\bin" -Force
