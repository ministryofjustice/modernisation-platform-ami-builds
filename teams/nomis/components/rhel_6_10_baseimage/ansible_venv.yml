---
name: nomis_rhel_6_10_baseimage_ansible_venv
description: rhel 6.10 base image component for installing ansible virtual environment
schemaVersion: 1.0
parameters:
  - Version:
      type: string
      default: "0.0.1"
      description: Component version (update this each time the file changes)
  - Platform:
      type: string
      default: "Linux"
      description: Platform.
phases:
  - name: build
    steps:
      # Install ansible-core (2.11.12) in virtual env
      - name: InstallAnsibleIntoVirtualEnv
        action: ExecuteBash
        inputs:
          commands:
            - |
              set -e

              # install, create, activate virtual environment
              mkdir -p /var/lib/venv && cd "$_"
              python3.6 -m venv ansible
              source ansible/bin/activate

              # install ansible modules in virtual env
              python3.6 -m pip install --upgrade pip
              python3.6 -m pip install wheel
              python3.6 -m pip install cryptography==2.3
              export LC_ALL=en_US.UTF-8
              python3.6 -m pip install ansible-core==2.11.12

              deactivate
